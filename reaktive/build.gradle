setupMultiplatformLibrary(project)

kotlin {
    sourceSets {
        commonMain {
            dependencies {
                implementation project(':reaktive-annotations')
            }
        }

        commonTest {
            dependencies {
                implementation project(':reaktive-test')
            }
        }
    }
}

final target = Target.currentTarget()

if (target.isCommon() || target.isMeta()) {
    setupCommonTargets(project)

    kotlin {
        targets { 
//            fromPreset(presets.jvm, 'jvmCommon')
//            fromPreset(presets.jvm, 'jvmJsCommon')
//            fromPreset(presets.linuxX64, 'nativeCommon')
//            fromPreset(presets.linuxX64, 'linuxCommon')
        }

        sourceSets {
            jvmJsCommonMain.dependsOn commonMain
            jvmJsCommonTest.dependsOn commonTest

            jvmCommonMain.dependsOn jvmJsCommonMain
            jvmCommonTest.dependsOn jvmJsCommonTest

            jvmMain.dependsOn jvmCommonMain
            jvmTest.dependsOn jvmCommonTest

            androidMain.dependsOn jvmCommonMain
            androidTest.dependsOn jvmCommonTest

            jsMain.dependsOn jvmJsCommonMain
            jsTest.dependsOn jvmJsCommonTest

            nativeCommonMain.dependsOn commonMain
            nativeCommonTest.dependsOn commonTest

            linuxCommonMain.dependsOn nativeCommonMain
            linuxCommonTest.dependsOn nativeCommonTest

            linuxX64Main.dependsOn linuxCommonMain
            linuxX64Test.dependsOn linuxCommonTest

            linuxArm32HfpMain.dependsOn linuxCommonMain
            linuxArm32HfpTest.dependsOn linuxCommonTest
        }
    }
}

if (target.isIos() || target.isMeta()) {
    setupIosTargets(project)

    kotlin {
        targets { 
//            fromPreset(presets.iosX64, 'iosCommon')
        }

        sourceSets {
            iosCommonMain.dependsOn nativeCommonMain
            iosCommonTest.dependsOn nativeCommonTest

            ios32Main.dependsOn iosCommonMain
            ios32Test.dependsOn iosCommonTest

            ios64Main.dependsOn iosCommonMain
            ios64Test.dependsOn iosCommonTest

            iosSimMain.dependsOn iosCommonMain
            iosSimTest.dependsOn iosCommonTest
        }
    }
}